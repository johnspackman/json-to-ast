{"version":3,"sources":["parse.js"],"names":["literals","STRING","NUMBER","TRUE","FALSE","NULL","objectStates","_START_","OPEN_OBJECT","PROPERTY","COMMA","propertyStates","KEY","COLON","arrayStates","OPEN_ARRAY","VALUE","defaultSettings","verbose","source","comment","value","name","token","comments","undefined","valueComments","forEach","push","loc","parseObject","input","tokenizer","settings","startToken","object","type","children","state","hasMore","LEFT_BRACE","tokenIndex","next","RIGHT_BRACE","start","line","column","offset","end","endToken","property","parseProperty","length","unexpectedToken","substring","unexpectedEnd","key","colonToken","parseValue","parseArray","array","LEFT_BRACKET","RIGHT_BRACKET","parseLiteral","isLiteral","indexOf","literal","rawValue","arguments","parseToAst","tokenize","result"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,KAAMA,WAAW,CAChB,qBAAWC,MADK,EAEhB,qBAAWC,MAFK,EAGhB,qBAAWC,IAHK,EAIhB,qBAAWC,KAJK,EAKhB,qBAAWC,IALK,CAAjB;;AAQA,KAAMC,eAAe;AACpBC,WAAS,CADW;AAEpBC,eAAa,CAFO;AAGpBC,YAAU,CAHU;AAIpBC,SAAO;AAJa,EAArB;;AAOA,KAAMC,iBAAiB;AACtBJ,WAAS,CADa;AAEtBK,OAAK,CAFiB;AAGtBC,SAAO;AAHe,EAAvB;;AAMA,KAAMC,cAAc;AACnBP,WAAS,CADU;AAEnBQ,cAAY,CAFO;AAGnBC,SAAO,CAHY;AAInBN,SAAO;AAJY,EAApB;;AAOA,KAAMO,kBAAkB;AACvBC,WAAS,IADc;AAEvBC,UAAQ;AAFe,EAAxB;;AAKA,UAASC,OAAT,CAAiBC,KAAjB,EAAwBC,IAAxB,EAA8BC,KAA9B,EAAqC;AACnC,MAAIA,MAAMC,QAAN,KAAmBC,SAAvB,EAAkC;AAChC,OAAIC,gBAAgBL,MAAMC,IAAN,CAApB;AACA,OAAII,kBAAkBD,SAAtB,EACEC,gBAAgBL,MAAMC,IAAN,IAAc,EAA9B;AACFC,SAAMC,QAAN,CAAeG,OAAf,CAAuB,UAASP,OAAT,EAAkB;AACvCM,kBAAcE,IAAd,CAAmB;AACjBC,UAAKT,QAAQS,GADI;AAEjBV,aAAQC,QAAQC;AAFC,KAAnB;AAID,IALD;AAMD;AACF;;AAED,UAASS,WAAT,CAAqBC,KAArB,EAA4BC,SAA5B,EAAuCC,QAAvC,EAAiD;AAChD;AACA,MAAIC,mBAAJ;AACA,MAAIC,SAAS;AACZC,SAAM,QADM;AAEZC,aAAU;AAFE,GAAb;AAIA,MAAIC,QAAQhC,aAAaC,OAAzB;;AAEA,SAAOyB,UAAUO,OAAV,EAAP,EAA4B;AAC3B,OAAMhB,QAAQS,UAAUT,KAAV,EAAd;;AAEA,WAAQe,KAAR;AACC,SAAKhC,aAAaC,OAAlB;AAA2B;AAC1B,UAAIgB,MAAMa,IAAN,KAAe,qBAAWI,UAA9B,EAA0C;AACzCN,oBAAaX,KAAb;AACAe,eAAQhC,aAAaE,WAArB;AACA,WAAIyB,SAASf,OAAb,EAAsB;AACpBiB,eAAOD,UAAP,GAAoBF,UAAUS,UAA9B;AACArB,gBAAQe,MAAR,EAAgB,iBAAhB,EAAmCZ,KAAnC;AACD;AACDS,iBAAUU,IAAV;AACA,OARD,MAQO;AACN,cAAO,IAAP;AACA;AACD;AACA;;AAED,SAAKpC,aAAaE,WAAlB;AAA+B;AAC9B,UAAIe,MAAMa,IAAN,KAAe,qBAAWO,WAA9B,EAA2C;AAC1C,WAAIV,SAASf,OAAb,EAAsB;AACrBiB,eAAON,GAAP,GAAa,wBACZK,WAAWL,GAAX,CAAee,KAAf,CAAqBC,IADT,EAEZX,WAAWL,GAAX,CAAee,KAAf,CAAqBE,MAFT,EAGZZ,WAAWL,GAAX,CAAee,KAAf,CAAqBG,MAHT,EAIZxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcH,IAJF,EAKZtB,MAAMM,GAAN,CAAUmB,GAAV,CAAcF,MALF,EAMZvB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MANF,EAOZd,SAASd,MAPG,CAAb;AASAgB,eAAOc,QAAP,GAAkBjB,UAAUS,UAA5B;AACArB,gBAAQe,MAAR,EAAgB,kBAAhB,EAAoCZ,KAApC;AACA;AACDS,iBAAUU,IAAV;AACA,cAAO;AACNrB,eAAOc;AADD,QAAP;AAGA,OAlBD,MAkBO;AACN,WAAMe,WAAWC,cAAcpB,KAAd,EAAqBC,SAArB,EAAgCC,QAAhC,CAAjB;AACAE,cAAOE,QAAP,CAAgBT,IAAhB,CAAqBsB,SAAS7B,KAA9B;AACAiB,eAAQhC,aAAaG,QAArB;AACA;AACD;AACA;;AAED,SAAKH,aAAaG,QAAlB;AAA4B;AAC3B,UAAIc,MAAMa,IAAN,KAAe,qBAAWO,WAA9B,EAA2C;AAC1C,WAAIV,SAASf,OAAb,EAAsB;AACrBiB,eAAON,GAAP,GAAa,wBACZK,WAAWL,GAAX,CAAee,KAAf,CAAqBC,IADT,EAEZX,WAAWL,GAAX,CAAee,KAAf,CAAqBE,MAFT,EAGZZ,WAAWL,GAAX,CAAee,KAAf,CAAqBG,MAHT,EAIZxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcH,IAJF,EAKZtB,MAAMM,GAAN,CAAUmB,GAAV,CAAcF,MALF,EAMZvB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MANF,EAOZd,SAASd,MAPG,CAAb;AASAgB,eAAOc,QAAP,GAAkBjB,UAAUS,UAA5B;AACArB,gBAAQe,MAAR,EAAgB,kBAAhB,EAAoCZ,KAApC;AACA;AACDS,iBAAUU,IAAV;AACA,cAAO;AACNrB,eAAOc;AADD,QAAP;AAGA,OAlBD,MAkBO,IAAIZ,MAAMa,IAAN,KAAe,qBAAW1B,KAA9B,EAAqC;AAC3CU,eAAQe,OAAOE,QAAP,CAAgBF,OAAOE,QAAP,CAAgBe,MAAhB,GAAyB,CAAzC,CAAR,EAAqD,kBAArD,EAAyE7B,KAAzE;AACAe,eAAQhC,aAAaI,KAArB;AACAsB,iBAAUU,IAAV;AACA,OAJM,MAIA;AACN,4BACC,0BAAgBW,eAAhB,CACCtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADD,EAECxB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFjB,EAGCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHjB,CADD,EAMCf,KAND,EAOCR,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPjB,EAQCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARjB;AAUA;AACD;AACA;;AAED,SAAKxC,aAAaI,KAAlB;AAAyB;AACxB,UAAMwC,YAAWC,cAAcpB,KAAd,EAAqBC,SAArB,EAAgCC,QAAhC,CAAjB;AACA,UAAIiB,SAAJ,EAAc;AACbf,cAAOE,QAAP,CAAgBT,IAAhB,CAAqBsB,UAAS7B,KAA9B;AACAiB,eAAQhC,aAAaG,QAArB;AACA,OAHD,MAGO;AACN,4BACC,0BAAgB4C,eAAhB,CACCtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADD,EAECxB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFjB,EAGCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHjB,CADD,EAMCf,KAND,EAOCR,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPjB,EAQCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARjB;AAUA;AACD;AACA;AAnGF;AAqGA;;AAED,uBAAM,0BAAgBS,aAAhB,EAAN;AACA;;AAED,UAASJ,aAAT,CAAuBpB,KAAvB,EAA8BC,SAA9B,EAAyCC,QAAzC,EAAmD;AAClD;AACA,MAAIC,mBAAJ;AACA,MAAIgB,WAAW;AACdd,SAAM,UADQ;AAEdoB,QAAK,IAFS;AAGdnC,UAAO;AAHO,GAAf;AAKA,MAAIiB,QAAQhC,aAAaC,OAAzB;;AAEA,SAAOyB,UAAUO,OAAV,EAAP,EAA4B;AAC3B,OAAMhB,QAAQS,UAAUT,KAAV,EAAd;;AAEA,WAAQe,KAAR;AACC,SAAK3B,eAAeJ,OAApB;AAA6B;AAC5B,UAAIgB,MAAMa,IAAN,KAAe,qBAAWnC,MAA9B,EAAsC;AACrC,WAAMuD,MAAM;AACXpB,cAAM,YADK;AAEXf,eAAOE,MAAMF;AAFF,QAAZ;AAIA,WAAIY,SAASf,OAAb,EAAsB;AACrBsC,YAAI3B,GAAJ,GAAUN,MAAMM,GAAhB;AACAqB,iBAAShB,UAAT,GAAsBsB,IAAItB,UAAJ,GAAiBsB,IAAIP,QAAJ,GAAejB,UAAUS,UAAhE;AACArB,gBAAQoC,GAAR,EAAa,iBAAb,EAAgCjC,KAAhC;AACA;AACDW,oBAAaX,KAAb;AACA2B,gBAASM,GAAT,GAAeA,GAAf;AACAlB,eAAQ3B,eAAeC,GAAvB;AACAoB,iBAAUU,IAAV;AACA,OAdD,MAcO;AACN,cAAO,IAAP;AACA;AACD;AACA;;AAED,SAAK/B,eAAeC,GAApB;AAAyB;AACxB,UAAIW,MAAMa,IAAN,KAAe,qBAAWvB,KAA9B,EAAqC;AACpC,WAAIoB,SAASf,OAAb,EAAsB;AAClBE,gBAAQ8B,SAASM,GAAjB,EAAsB,kBAAtB,EAA0CjC,KAA1C;AACA2B,iBAASO,UAAT,GAAsBlC,KAAtB;AACH;AACDe,eAAQ3B,eAAeE,KAAvB;AACAmB,iBAAUU,IAAV;AACA,OAPD,MAOO;AACN,4BACC,0BAAgBW,eAAhB,CACCtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADD,EAECxB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFjB,EAGCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHjB,CADD,EAMCf,KAND,EAOCR,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPjB,EAQCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARjB;AAUA;AACD;AACA;;AAED,SAAKnC,eAAeE,KAApB;AAA2B;AAC1B,UAAMQ,QAAQqC,WAAW3B,KAAX,EAAkBC,SAAlB,EAA6BC,QAA7B,CAAd;AACAiB,eAAS7B,KAAT,GAAiBA,MAAMA,KAAvB;AACA,UAAIY,SAASf,OAAb,EAAsB;AACrBgC,gBAASD,QAAT,GAAoB5B,MAAMA,KAAN,CAAY4B,QAAhC;AACAC,gBAASrB,GAAT,GAAe,wBACdK,WAAWL,GAAX,CAAee,KAAf,CAAqBC,IADP,EAEdX,WAAWL,GAAX,CAAee,KAAf,CAAqBE,MAFP,EAGdZ,WAAWL,GAAX,CAAee,KAAf,CAAqBG,MAHP,EAId1B,MAAMA,KAAN,CAAYQ,GAAZ,CAAgBmB,GAAhB,CAAoBH,IAJN,EAKdxB,MAAMA,KAAN,CAAYQ,GAAZ,CAAgBmB,GAAhB,CAAoBF,MALN,EAMdzB,MAAMA,KAAN,CAAYQ,GAAZ,CAAgBmB,GAAhB,CAAoBD,MANN,EAOdd,SAASd,MAPK,CAAf;AASA;AACD,aAAO;AACNE,cAAO6B;AADD,OAAP;AAGA;;AA/DF;AAkEA;AACD;;AAED,UAASS,UAAT,CAAoB5B,KAApB,EAA2BC,SAA3B,EAAsCC,QAAtC,EAAgD;AAC/C;AACA,MAAIC,mBAAJ;AACA,MAAI0B,QAAQ;AACXxB,SAAM,OADK;AAEXC,aAAU;AAFC,GAAZ;AAIA,MAAIC,QAAQxB,YAAYP,OAAxB;AACA,MAAIgB,cAAJ;;AAEA,SAAOS,UAAUO,OAAV,EAAP,EAA4B;AAC3BhB,WAAQS,UAAUT,KAAV,EAAR;;AAEA,WAAQe,KAAR;AACC,SAAKxB,YAAYP,OAAjB;AAA0B;AACzB,UAAIgB,MAAMa,IAAN,KAAe,qBAAWyB,YAA9B,EAA4C;AAC3C3B,oBAAaX,KAAb;AACA,WAAIU,SAASf,OAAb,EAAsB;AACpB0C,cAAM1B,UAAN,GAAmBF,UAAUS,UAA7B;AACArB,gBAAQwC,KAAR,EAAe,iBAAf,EAAkCrC,KAAlC;AACD;AACDe,eAAQxB,YAAYC,UAApB;AACAiB,iBAAUU,IAAV;AACA,OARD,MAQO;AACN,cAAO,IAAP;AACA;AACD;AACA;;AAED,SAAK5B,YAAYC,UAAjB;AAA6B;AAC5B,UAAIQ,MAAMa,IAAN,KAAe,qBAAW0B,aAA9B,EAA6C;AAC5C,WAAI7B,SAASf,OAAb,EAAsB;AACrB0C,cAAM/B,GAAN,GAAY,wBACXK,WAAWL,GAAX,CAAee,KAAf,CAAqBC,IADV,EAEXX,WAAWL,GAAX,CAAee,KAAf,CAAqBE,MAFV,EAGXZ,WAAWL,GAAX,CAAee,KAAf,CAAqBG,MAHV,EAIXxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcH,IAJH,EAKXtB,MAAMM,GAAN,CAAUmB,GAAV,CAAcF,MALH,EAMXvB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MANH,EAOXd,SAASd,MAPE,CAAZ;AASAyC,cAAMX,QAAN,GAAiBjB,UAAUS,UAA3B;AACArB,gBAAQwC,KAAR,EAAe,kBAAf,EAAmCrC,KAAnC;AACA;AACDS,iBAAUU,IAAV;AACA,cAAO;AACNrB,eAAOuC;AADD,QAAP;AAGA,OAlBD,MAkBO;AACN,WAAIvC,QAAQqC,WAAW3B,KAAX,EAAkBC,SAAlB,EAA6BC,QAA7B,CAAZ;AACA2B,aAAMvB,QAAN,CAAeT,IAAf,CAAoBP,MAAMA,KAA1B;AACAiB,eAAQxB,YAAYE,KAApB;AACA;AACD;AACA;;AAED,SAAKF,YAAYE,KAAjB;AAAwB;AACvB,UAAIO,MAAMa,IAAN,KAAe,qBAAW0B,aAA9B,EAA6C;AAC5C,WAAI7B,SAASf,OAAb,EAAsB;AACrB0C,cAAM/B,GAAN,GAAY,wBACXK,WAAWL,GAAX,CAAee,KAAf,CAAqBC,IADV,EAEXX,WAAWL,GAAX,CAAee,KAAf,CAAqBE,MAFV,EAGXZ,WAAWL,GAAX,CAAee,KAAf,CAAqBG,MAHV,EAIXxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcH,IAJH,EAKXtB,MAAMM,GAAN,CAAUmB,GAAV,CAAcF,MALH,EAMXvB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MANH,EAOXd,SAASd,MAPE,CAAZ;AASAyC,cAAMX,QAAN,GAAiBjB,UAAUS,UAA3B;AACArB,gBAAQwC,KAAR,EAAe,kBAAf,EAAmCrC,KAAnC;AACA;AACDS,iBAAUU,IAAV;AACA,cAAO;AACNrB,eAAOuC;AADD,QAAP;AAGA,OAlBD,MAkBO,IAAIrC,MAAMa,IAAN,KAAe,qBAAW1B,KAA9B,EAAqC;AAC3C4B,eAAQxB,YAAYJ,KAApB;AACAsB,iBAAUU,IAAV;AACA,OAHM,MAGA;AACN,4BACC,0BAAgBW,eAAhB,CACCtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADD,EAECxB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFjB,EAGCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHjB,CADD,EAMCf,KAND,EAOCR,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPjB,EAQCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARjB;AAUA;AACD;AACA;;AAED,SAAKhC,YAAYJ,KAAjB;AAAwB;AACvB,UAAIW,SAAQqC,WAAW3B,KAAX,EAAkBC,SAAlB,EAA6BC,QAA7B,CAAZ;AACA2B,YAAMvB,QAAN,CAAeT,IAAf,CAAoBP,OAAMA,KAA1B;AACAiB,cAAQxB,YAAYE,KAApB;AACA;AACA;AArFF;AAuFA;;AAED,uBACC,0BAAgBuC,aAAhB,EADD;AAGA;;AAED,UAASQ,YAAT,CAAsBhC,KAAtB,EAA6BC,SAA7B,EAAwCC,QAAxC,EAAkD;AACjD;AACA,MAAMV,QAAQS,UAAUT,KAAV,EAAd;;AAEA,MAAMyC,YAAYhE,SAASiE,OAAT,CAAiB1C,MAAMa,IAAvB,MAAiC,CAAC,CAApD;;AAEA,MAAI4B,SAAJ,EAAe;AACd,OAAME,UAAU;AACf9B,UAAM,SADS;AAEff,WAAOE,MAAMF,KAFE;AAGf8C,cAAUpC,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD;AAHK,IAAhB;AAKA,OAAId,SAASf,OAAb,EAAsB;AACrBgD,YAAQrC,GAAR,GAAcN,MAAMM,GAApB;AACAqC,YAAQhC,UAAR,GAAqBgC,QAAQjB,QAAR,GAAmBjB,UAAUS,UAAlD;AACArB,YAAQ8C,OAAR,EAAiB,iBAAjB,EAAoC3C,KAApC;AACA;AACDS,aAAUU,IAAV;AACA,UAAO;AACNrB,WAAO6C;AADD,IAAP;AAGA;;AAED,SAAO,IAAP;AACA;;AAED,UAASR,UAAT,CAAoB3B,KAApB,EAA2BC,SAA3B,EAAsCC,QAAtC,EAAgD;AAC/C;AACA,MAAMV,QAAQS,UAAUT,KAAV,EAAd;;AAEA,MAAMF,QACL0C,8BAAgBK,SAAhB,KACGtC,6BAAesC,SAAf,CADH,IAEGT,4BAAcS,SAAd,CAHJ;;AAMA,MAAI/C,KAAJ,EAAW;AACV,UAAOA,KAAP;AACA,GAFD,MAEO;AACN,wBACC,0BAAgBgC,eAAhB,CACCtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADD,EAECxB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFjB,EAGCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHjB,CADD,EAMCf,KAND,EAOCR,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPjB,EAQCtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARjB;AAUA;AACD;;AAED,UAASuB,UAAT,CAAoBtC,KAApB,EAA2BE,QAA3B,EAAqC;AACnCA,aAAW,SAAc,EAAd,EAAkBhB,eAAlB,EAAmCgB,QAAnC,CAAX;AACA,MAAMD,YAAY,wBAAcD,KAAd,EAAqBE,QAArB,CAAlB;AACAD,YAAUsC,QAAV;;AAEA,MAAI,CAACtC,UAAUO,OAAV,EAAL,EAA0B;AACxB,wBAAM,0BAAgBgB,aAAhB,EAAN;AACD;;AAED,MAAMlC,QAAQqC,WAAW3B,KAAX,EAAkBC,SAAlB,EAA6BC,QAA7B,CAAd;;AAEA,MAAI,CAACD,UAAUO,OAAV,EAAL,EAA0B;AACxB,OAAIgC,SAASlD,MAAMA,KAAnB;AACA,OAAIY,SAASf,OAAb,EAAsB;AACpBqD,WAAOvC,SAAP,GAAmBA,SAAnB;AACD;AACD,UAAOuC,MAAP;AACD,GAND,MAMO;AACL,OAAMhD,QAAQS,UAAUU,IAAV,EAAd;AACA,wBACE,0BAAgBW,eAAhB,CACEtB,MAAMuB,SAAN,CAAgB/B,MAAMM,GAAN,CAAUe,KAAV,CAAgBG,MAAhC,EAAwCxB,MAAMM,GAAN,CAAUmB,GAAV,CAAcD,MAAtD,CADF,EAEExB,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAFlB,EAGEtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MAHlB,CADF,EAMEf,KANF,EAOER,MAAMM,GAAN,CAAUe,KAAV,CAAgBC,IAPlB,EAQEtB,MAAMM,GAAN,CAAUe,KAAV,CAAgBE,MARlB;AAUD;AACF;;mBAEcuB,U","file":"parse.js","sourcesContent":["import location from './location';\n\nimport error from './error';\nimport parseErrorTypes from './parseErrorTypes';\nimport {Tokenizer, tokenTypes} from './tokenize';\n\nconst literals = [\n\ttokenTypes.STRING,\n\ttokenTypes.NUMBER,\n\ttokenTypes.TRUE,\n\ttokenTypes.FALSE,\n\ttokenTypes.NULL\n];\n\nconst objectStates = {\n\t_START_: 0,\n\tOPEN_OBJECT: 1,\n\tPROPERTY: 2,\n\tCOMMA: 3\n};\n\nconst propertyStates = {\n\t_START_: 0,\n\tKEY: 1,\n\tCOLON: 2\n};\n\nconst arrayStates = {\n\t_START_: 0,\n\tOPEN_ARRAY: 1,\n\tVALUE: 2,\n\tCOMMA: 3\n};\n\nconst defaultSettings = {\n\tverbose: true,\n\tsource: null\n};\n\nfunction comment(value, name, token) {\n  if (token.comments !== undefined) {\n    var valueComments = value[name];\n    if (valueComments === undefined)\n      valueComments = value[name] = [];\n    token.comments.forEach(function(comment) {\n      valueComments.push({\n        loc: comment.loc,\n        source: comment.value\n      });\n    });\n  }\n}\n\nfunction parseObject(input, tokenizer, settings) {\n\t// object: LEFT_BRACE (property (COMMA property)*)? RIGHT_BRACE\n\tlet startToken;\n\tlet object = {\n\t\ttype: 'object',\n\t\tchildren: []\n\t};\n\tlet state = objectStates._START_;\n\n\twhile (tokenizer.hasMore()) {\n\t\tconst token = tokenizer.token();\n\n\t\tswitch (state) {\n\t\t\tcase objectStates._START_: {\n\t\t\t\tif (token.type === tokenTypes.LEFT_BRACE) {\n\t\t\t\t\tstartToken = token;\n\t\t\t\t\tstate = objectStates.OPEN_OBJECT;\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t  object.startToken = tokenizer.tokenIndex;\n\t\t\t\t\t  comment(object, \"leadingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase objectStates.OPEN_OBJECT: {\n\t\t\t\tif (token.type === tokenTypes.RIGHT_BRACE) {\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t\tobject.loc = location(\n\t\t\t\t\t\t\tstartToken.loc.start.line,\n\t\t\t\t\t\t\tstartToken.loc.start.column,\n\t\t\t\t\t\t\tstartToken.loc.start.offset,\n\t\t\t\t\t\t\ttoken.loc.end.line,\n\t\t\t\t\t\t\ttoken.loc.end.column,\n\t\t\t\t\t\t\ttoken.loc.end.offset,\n\t\t\t\t\t\t\tsettings.source\n\t\t\t\t\t\t);\n\t\t\t\t\t\tobject.endToken = tokenizer.tokenIndex;\n\t\t\t\t\t\tcomment(object, \"trailingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: object\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tconst property = parseProperty(input, tokenizer, settings);\n\t\t\t\t\tobject.children.push(property.value);\n\t\t\t\t\tstate = objectStates.PROPERTY;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase objectStates.PROPERTY: {\n\t\t\t\tif (token.type === tokenTypes.RIGHT_BRACE) {\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t\tobject.loc = location(\n\t\t\t\t\t\t\tstartToken.loc.start.line,\n\t\t\t\t\t\t\tstartToken.loc.start.column,\n\t\t\t\t\t\t\tstartToken.loc.start.offset,\n\t\t\t\t\t\t\ttoken.loc.end.line,\n\t\t\t\t\t\t\ttoken.loc.end.column,\n\t\t\t\t\t\t\ttoken.loc.end.offset,\n\t\t\t\t\t\t\tsettings.source\n\t\t\t\t\t\t);\n\t\t\t\t\t\tobject.endToken = tokenizer.tokenIndex;\n\t\t\t\t\t\tcomment(object, \"trailingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: object\n\t\t\t\t\t};\n\t\t\t\t} else if (token.type === tokenTypes.COMMA) {\n\t\t\t\t\tcomment(object.children[object.children.length - 1], \"trailingComments\", token);\n\t\t\t\t\tstate = objectStates.COMMA;\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\terror(\n\t\t\t\t\t\tparseErrorTypes.unexpectedToken(\n\t\t\t\t\t\t\tinput.substring(token.loc.start.offset, token.loc.end.offset),\n\t\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t\t),\n\t\t\t\t\t\tinput,\n\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase objectStates.COMMA: {\n\t\t\t\tconst property = parseProperty(input, tokenizer, settings);\n\t\t\t\tif (property) {\n\t\t\t\t\tobject.children.push(property.value);\n\t\t\t\t\tstate = objectStates.PROPERTY;\n\t\t\t\t} else {\n\t\t\t\t\terror(\n\t\t\t\t\t\tparseErrorTypes.unexpectedToken(\n\t\t\t\t\t\t\tinput.substring(token.loc.start.offset, token.loc.end.offset),\n\t\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t\t),\n\t\t\t\t\t\tinput,\n\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\terror(parseErrorTypes.unexpectedEnd());\n}\n\nfunction parseProperty(input, tokenizer, settings) {\n\t// property: STRING COLON value\n\tlet startToken;\n\tlet property = {\n\t\ttype: 'property',\n\t\tkey: null,\n\t\tvalue: null\n\t};\n\tlet state = objectStates._START_;\n\n\twhile (tokenizer.hasMore()) {\n\t\tconst token = tokenizer.token();\n\n\t\tswitch (state) {\n\t\t\tcase propertyStates._START_: {\n\t\t\t\tif (token.type === tokenTypes.STRING) {\n\t\t\t\t\tconst key = {\n\t\t\t\t\t\ttype: 'identifier',\n\t\t\t\t\t\tvalue: token.value\n\t\t\t\t\t};\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t\tkey.loc = token.loc;\n\t\t\t\t\t\tproperty.startToken = key.startToken = key.endToken = tokenizer.tokenIndex;\n\t\t\t\t\t\tcomment(key, \"leadingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\tstartToken = token;\n\t\t\t\t\tproperty.key = key;\n\t\t\t\t\tstate = propertyStates.KEY;\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase propertyStates.KEY: {\n\t\t\t\tif (token.type === tokenTypes.COLON) {\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t    comment(property.key, \"trailingComments\", token);\n\t\t\t\t\t    property.colonToken = token;\n\t\t\t\t\t}\n\t\t\t\t\tstate = propertyStates.COLON;\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\terror(\n\t\t\t\t\t\tparseErrorTypes.unexpectedToken(\n\t\t\t\t\t\t\tinput.substring(token.loc.start.offset, token.loc.end.offset),\n\t\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t\t),\n\t\t\t\t\t\tinput,\n\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase propertyStates.COLON: {\n\t\t\t\tconst value = parseValue(input, tokenizer, settings);\n\t\t\t\tproperty.value = value.value;\n\t\t\t\tif (settings.verbose) {\n\t\t\t\t\tproperty.endToken = value.value.endToken;\n\t\t\t\t\tproperty.loc = location(\n\t\t\t\t\t\tstartToken.loc.start.line,\n\t\t\t\t\t\tstartToken.loc.start.column,\n\t\t\t\t\t\tstartToken.loc.start.offset,\n\t\t\t\t\t\tvalue.value.loc.end.line,\n\t\t\t\t\t\tvalue.value.loc.end.column,\n\t\t\t\t\t\tvalue.value.loc.end.offset,\n\t\t\t\t\t\tsettings.source\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tvalue: property\n\t\t\t\t};\n\t\t\t}\n\n\t\t}\n\t}\n}\n\nfunction parseArray(input, tokenizer, settings) {\n\t// array: LEFT_BRACKET (value (COMMA value)*)? RIGHT_BRACKET\n\tlet startToken;\n\tlet array = {\n\t\ttype: 'array',\n\t\tchildren: []\n\t};\n\tlet state = arrayStates._START_;\n\tlet token;\n\n\twhile (tokenizer.hasMore()) {\n\t\ttoken = tokenizer.token();\n\n\t\tswitch (state) {\n\t\t\tcase arrayStates._START_: {\n\t\t\t\tif (token.type === tokenTypes.LEFT_BRACKET) {\n\t\t\t\t\tstartToken = token;\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t  array.startToken = tokenizer.tokenIndex;\n\t\t\t\t\t  comment(array, \"leadingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\tstate = arrayStates.OPEN_ARRAY;\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase arrayStates.OPEN_ARRAY: {\n\t\t\t\tif (token.type === tokenTypes.RIGHT_BRACKET) {\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t\tarray.loc = location(\n\t\t\t\t\t\t\tstartToken.loc.start.line,\n\t\t\t\t\t\t\tstartToken.loc.start.column,\n\t\t\t\t\t\t\tstartToken.loc.start.offset,\n\t\t\t\t\t\t\ttoken.loc.end.line,\n\t\t\t\t\t\t\ttoken.loc.end.column,\n\t\t\t\t\t\t\ttoken.loc.end.offset,\n\t\t\t\t\t\t\tsettings.source\n\t\t\t\t\t\t);\n\t\t\t\t\t\tarray.endToken = tokenizer.tokenIndex;\n\t\t\t\t\t\tcomment(array, \"trailingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: array\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tlet value = parseValue(input, tokenizer, settings);\n\t\t\t\t\tarray.children.push(value.value);\n\t\t\t\t\tstate = arrayStates.VALUE;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase arrayStates.VALUE: {\n\t\t\t\tif (token.type === tokenTypes.RIGHT_BRACKET) {\n\t\t\t\t\tif (settings.verbose) {\n\t\t\t\t\t\tarray.loc = location(\n\t\t\t\t\t\t\tstartToken.loc.start.line,\n\t\t\t\t\t\t\tstartToken.loc.start.column,\n\t\t\t\t\t\t\tstartToken.loc.start.offset,\n\t\t\t\t\t\t\ttoken.loc.end.line,\n\t\t\t\t\t\t\ttoken.loc.end.column,\n\t\t\t\t\t\t\ttoken.loc.end.offset,\n\t\t\t\t\t\t\tsettings.source\n\t\t\t\t\t\t);\n\t\t\t\t\t\tarray.endToken = tokenizer.tokenIndex;\n\t\t\t\t\t\tcomment(array, \"trailingComments\", token);\n\t\t\t\t\t}\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: array\n\t\t\t\t\t};\n\t\t\t\t} else if (token.type === tokenTypes.COMMA) {\n\t\t\t\t\tstate = arrayStates.COMMA;\n\t\t\t\t\ttokenizer.next();\n\t\t\t\t} else {\n\t\t\t\t\terror(\n\t\t\t\t\t\tparseErrorTypes.unexpectedToken(\n\t\t\t\t\t\t\tinput.substring(token.loc.start.offset, token.loc.end.offset),\n\t\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t\t),\n\t\t\t\t\t\tinput,\n\t\t\t\t\t\ttoken.loc.start.line,\n\t\t\t\t\t\ttoken.loc.start.column\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase arrayStates.COMMA: {\n\t\t\t\tlet value = parseValue(input, tokenizer, settings);\n\t\t\t\tarray.children.push(value.value);\n\t\t\t\tstate = arrayStates.VALUE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\terror(\n\t\tparseErrorTypes.unexpectedEnd()\n\t);\n}\n\nfunction parseLiteral(input, tokenizer, settings) {\n\t// literal: STRING | NUMBER | TRUE | FALSE | NULL\n\tconst token = tokenizer.token();\n\n\tconst isLiteral = literals.indexOf(token.type) !== -1;\n\n\tif (isLiteral) {\n\t\tconst literal = {\n\t\t\ttype: 'literal',\n\t\t\tvalue: token.value,\n\t\t\trawValue: input.substring(token.loc.start.offset, token.loc.end.offset)\n\t\t};\n\t\tif (settings.verbose) {\n\t\t\tliteral.loc = token.loc;\n\t\t\tliteral.startToken = literal.endToken = tokenizer.tokenIndex;\n\t\t\tcomment(literal, \"leadingComments\", token);\n\t\t}\n\t\ttokenizer.next();\n\t\treturn {\n\t\t\tvalue: literal\n\t\t}\n\t}\n\n\treturn null;\n}\n\nfunction parseValue(input, tokenizer, settings) {\n\t// value: literal | object | array\n\tconst token = tokenizer.token();\n\n\tconst value = (\n\t\tparseLiteral(...arguments)\n\t\t|| parseObject(...arguments)\n\t\t|| parseArray(...arguments)\n\t);\n\n\tif (value) {\n\t\treturn value;\n\t} else {\n\t\terror(\n\t\t\tparseErrorTypes.unexpectedToken(\n\t\t\t\tinput.substring(token.loc.start.offset, token.loc.end.offset),\n\t\t\t\ttoken.loc.start.line,\n\t\t\t\ttoken.loc.start.column\n\t\t\t),\n\t\t\tinput,\n\t\t\ttoken.loc.start.line,\n\t\t\ttoken.loc.start.column\n\t\t);\n\t}\n}\n\nfunction parseToAst(input, settings) {\n  settings = Object.assign({}, defaultSettings, settings);\n  const tokenizer = new Tokenizer(input, settings);\n  tokenizer.tokenize();\n\n  if (!tokenizer.hasMore()) {\n    error(parseErrorTypes.unexpectedEnd());\n  }\n\n  const value = parseValue(input, tokenizer, settings);\n\n  if (!tokenizer.hasMore()) {\n    var result = value.value;\n    if (settings.verbose) {\n      result.tokenizer = tokenizer;\n    }\n    return result;\n  } else {\n    const token = tokenizer.next();\n    error(\n      parseErrorTypes.unexpectedToken(\n        input.substring(token.loc.start.offset, token.loc.end.offset),\n        token.loc.start.line,\n        token.loc.start.column\n      ),\n      input,\n      token.loc.start.line,\n      token.loc.start.column\n    );\n  }\n}\n\nexport default parseToAst;\n\n\n"]}